"use strict";var visi_ap_ad__VERSION__=visi_ap_ad__VERSION__||(function(){return{pool:function(b){var a,c;if(navigator.appVersion.indexOf("MSIE")!==-1){c=document.createElement("script");c.src=b;window.top.document.body.appendChild(c)}else{if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{return}a.open("GET",b,false);a.send(null)}}}}());var WR_VIS__VERSION__=WR_VIS__VERSION__||(function(){var h,l,g,r,e=true,k,b,j="",a;function o(s){if(j===""){return}if(r.isIE){return}if(typeof console!=="undefined"){if(typeof console.debug==="function"){console.debug(s)}if(typeof console.log==="object"){console.log(s)}}}function p(){if(r.isIE){return}if(typeof console!=="undefined"){if(typeof console.clear==="function"||typeof console.clear==="object"){console.clear()}}}function n(s){return s===undefined||s===null||s.length===0}function i(u){var t=[],s,v;if(typeof u==="object"){for(s in u){if(u.hasOwnProperty(s)){if(typeof u[s]!=="object"){v=u[s];if(typeof v==="boolean"){v=v?1:0}t.push(s+":"+v)}}}}return t.join(",")}function m(u){var t=[],s;if(typeof u==="object"){for(s in u){if(u.hasOwnProperty(s)){t.push(s)}}}return t}function c(u){var t=[],s;if(typeof u==="object"){for(s in u){if(u.hasOwnProperty(s)){t.push(i(u[s]))}}}return t}function q(s){var u,t;if(typeof(s)!=="object"||s===null){return s}u=s.constructor();for(t in s){if(s.hasOwnProperty(t)){u[t]=q(s[t])}}return u}function f(u,t){var s=document.getElementById(u),v="";if(n(s)){return v}if(s.currentStyle){v=s.currentStyle[t]}else{if(window.getComputedStyle){v=document.defaultView.getComputedStyle(s,null).getPropertyValue(t)}}return v}r=navigator;r.isFirefox=(r.userAgent.indexOf("Firefox")!==-1);r.isIE=(r.appVersion.indexOf("MSIE")!==-1);r.isOpera=(r.userAgent.indexOf("Opera")!==-1);r.isSafari=(r.appVersion.indexOf("Safari")!==-1);r.isChrome=(r.appVersion.indexOf("Chrome")!==-1);if(r.isChrome){r.isSafari=false}r.isIframe=window.location!==window.parent.location;h={data:{},externalMonitor:undefined,activity:{state:false,start:undefined,isActive:false,minMouseMove:r.isIE?3:0},params:{call:"",callkey:"",minVisiblePct:50,minVisibleTime:1000,maxTimeInactivity:60000}};l={};g={alreadyRegistered:function(s,t){return s!==undefined&&l[s]!==undefined&&l[s].data[t]!==undefined},elmExist:function(s){return document.getElementById(s)!==null},elmVisible:function(s){if(!g.elmExist(s)){return false}else{if((f(s,"display")==="none"||f(s,"visibility")==="hidden")&&!g.isWeboPixel(s)){return false}}return true},isWeboPixel:function(s){if(s.match(/wbo_visi_on_\d+/gi)===null){return false}return true},isPixelBeforeCreative:function(s,t){if(!b.exist(s)){return undefined}if(!g.alreadyRegistered(s,t)){return undefined}if(l[s].data[t].params.pix_pos==="1"){return true}return false},getWidth:function(s,v){var u,t;if(!b.exist(s)){return undefined}if(!g.alreadyRegistered(s,v)){return undefined}u=l[s].data[v].elm;if(g.isWeboPixel(v)){t=l[s].data[v].params.width}else{t=u.offsetWidth}return t},getHeight:function(s,v){var u,t;if(!b.exist(s)){return undefined}if(!g.alreadyRegistered(s,v)){return undefined}u=l[s].data[v].elm;if(g.isWeboPixel(v)){t=l[s].data[v].params.height}else{t=u.offsetHeight}return t},getOffsetTop:function(t,v){var u,s;if(!b.exist(t)){return undefined}if(!g.alreadyRegistered(t,v)){return undefined}u=l[t].data[v].elm;if(!g.isWeboPixel(v)){return u.offsetTop}if(g.isPixelBeforeCreative(t,v)){s=u.offsetTop}else{s=u.offsetTop-g.getHeight(t,v)}return s},getInnerSize:function(){var s=window.top.document.compatMode==="CSS1Compat"?window.top.document.documentElement:window.top.document.body;return[s.clientWidth,s.clientHeight]},getScroll:function(){var s=window.top.document.compatMode==="CSS1Compat"&&!(r.isSafari||r.isChrome)?window.top.document.documentElement:window.top.document.body;return[s.scrollLeft,s.scrollTop]},getSurface:function(s,v){var u,t;if(!b.exist(s)){return undefined}if(!g.alreadyRegistered(s,v)){return undefined}if(!g.elmVisible(v)){return 0}u=l[s].data[v].elm;t=parseFloat(g.getWidth(s,v))*parseFloat(g.getHeight(s,v));return t},getVisibleSize:function(w,t){var z,y,A,B,s,C,u,v,x,D;if(!b.exist(w)){return undefined}if(!g.alreadyRegistered(w,t)){return undefined}if(!g.elmVisible(t)){return 0}z=l[w].data[t].elm;y=g.getSurface(w,t);A=g.getInnerSize();B=A[0];s=A[1];C=g.getScroll();u=C[0];v=C[1];x=Math.min(Math.max(0,u+B-z.offsetLeft),g.getWidth(w,t))-Math.min(Math.max(0,u-z.offsetLeft),g.getWidth(w,t));D=Math.min(Math.max(0,v+s-g.getOffsetTop(w,t)),g.getHeight(w,t))-Math.min(Math.max(0,v-g.getOffsetTop(w,t)),g.getHeight(w,t));if(Math.min(x,D)===0){x=0;D=0}return[x,D]},getVisibleSurface:function(v,x){var t,u,w,s;if(!b.exist(v)){return undefined}if(!g.alreadyRegistered(v,x)){return undefined}if(!g.elmVisible(x)){return 0}t=g.getVisibleSize(v,x);u=t[0];w=t[1];s=u*w;return s},getPctVisibleSurface:function(t,v){var u,s;if(!b.exist(t)){return undefined}if(!g.alreadyRegistered(t,v)){return undefined}if(!g.elmVisible(v)){return 0}u=g.getSurface(t,v);s=g.getVisibleSurface(t,v);return u>0?parseInt(s*100/u,10):0},register:function(s,w,v){if(!b.exist(s)){return false}if(g.alreadyRegistered(s,w)){return false}if(!g.elmExist(w)){return false}if(n(v)||n(v[l[s].params.callkey])){return false}o("Tracking "+w);var u,t;u=l[s].data[w]={elm:document.getElementById(w),visible:false,visibleTime:0,visibleStart:undefined,checked:0,params:v};return true},release:function(u){if(!b.exist(u)){return false}if(n(l[u].params.call)||n(l[u].params.callkey)){return false}o("Release token "+u);var s,x,t=l[u].params.call,C=l[u].params.callkey,w={},B=0,y,v,A;t+=(t.indexOf("?")===-1)?"?":"&";for(s in l[u].data){if(l[u].data.hasOwnProperty(s)){y=l[u].data[s];g.inactivityCheck(u,{type:"blur"});o("Current : ");o(y);w[y.params[C]]=w[y.params[C]]||[];A=w[y.params[C]].length;w[y.params[C]][A]={};for(x in y.params){if(y.params.hasOwnProperty(x)){if(x!==C){w[y.params[C]][A][x]=y.params[x]}}}w[y.params[C]][A].vis=y.visible;w[y.params[C]][A].vt=y.visibleTime;B+=1}}if(!B){return false}for(s in w){if(w.hasOwnProperty(s)){t+=C+"_"+s+"="+c(w[s]).join(";")+"&"}}o("Data : ");o(w);t+=C+"="+m(w).join(",")+"&";t+="r="+parseInt(Math.random()*1000000,10);o("Call : "+t);try{visi_ap_ad__VERSION__.pool(t)}catch(z){o(z)}for(x=0;x<400000;x+=1){v=Math.cos(Math.random())}},getUnixTimeStamp:function(){var s=new Date();return Date.UTC(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDay(),s.getUTCHours(),s.getUTCMinutes(),s.getUTCSeconds(),s.getUTCMilliseconds())},monitor:function(s){if(!b.exist(s)){return}if(typeof l[s].externalMonitor==="function"){l[s].externalMonitor(g,s)}},getTotalTimeElapse:function(t,u){if(!b.exist(t)){return false}if(!g.alreadyRegistered(t,u)){return undefined}var s=l[t].data[u].visibleTime;if(l[t].data[u].visibleStart!==undefined){s+=g.getUnixTimeStamp()-l[t].data[u].visibleStart}return s},check:function(t,u){if(!b.exist(t)){return}var v,s;g.inactivityCheck(t);for(v in l[t].data){if(l[t].data.hasOwnProperty(v)){l[t].data[v].checked+=1;g.monitor(t);if(l[t].activity.state&&g.getPctVisibleSurface(t,v)>=l[t].params.minVisiblePct){if(l[t].data[v].visibleStart===undefined){o(v+" is ON");l[t].data[v].visibleStart=g.getUnixTimeStamp()}}else{if(l[t].data[v].visibleStart!==undefined){s=g.getUnixTimeStamp()-l[t].data[v].visibleStart;if(!l[t].activity.state){s=Math.min(g.getUnixTimeStamp(),l[t].activity.start+l[t].params.maxTimeInactivity)-l[t].data[v].visibleStart}l[t].data[v].visibleStart=undefined;if(s>l[t].params.minVisibleTime){l[t].data[v].visible=true}if(l[t].data[v].visible){l[t].data[v].visibleTime+=s}o(v+" is OFF");o(v+" visible time : "+l[t].data[v].visibleTime)}}}}},inactivityCheck:function(u,w){if(!b.exist(u)){return}var v=l[u].activity.state,t,s;if(v){s=g.getUnixTimeStamp()-l[u].activity.start;if(s>=l[u].params.maxTimeInactivity){v=false;l[u].activity.state=false;g.check(u,w)}}if(w!==undefined){if(w.type!=="mousemove"){o("Fire "+w.type)}if(w.type==="blur"){o("Focus : off");e=false}else{if(w.type==="focus"){e=true;o("Focus : on")}}if(l[u].activity.isActive){if(w.type!=="mousemove"){o("Testing "+w.type)}if(w.type==="blur"){l[u].activity.state=false}else{if(w.type==="mousemove"&&!e){o("No focus, then no mousemove check")}else{l[u].activity.start=g.getUnixTimeStamp();l[u].activity.state=true}}if(v!==l[u].activity.state){g.check(u,w)}}else{if(l[u].activity.minMouseMove>0&&w.type==="mousemove"){o("Min Mouse Move : "+l[u].activity.minMouseMove);if(e){l[u].activity.minMouseMove-=1;if(l[u].activity.minMouseMove<1){o("Mouse move OK !");l[u].activity.isActive=true}}}else{if(w.type!=="blur"&&w.type!=="focus"){l[u].activity.isActive=true}}if(l[u].activity.isActive){o("Starting !");g.inactivityCheck(u,w)}}}},checked:function(s,t){if(!b.exist(s)){return undefined}if(!g.alreadyRegistered(s,t)){return undefined}return l[s].data[t].checked}};k={pool:[],domReady:false,add:function(t,s,u){if(k.domReady){k.attach(t,s,u)}else{o("DOM not ready, postpone "+s);k.pool.push([t,s,u])}},type:(function(){var t,s;t=function(x,v,w){for(var u in v){if(v.hasOwnProperty(u)){x[v[u]]=w}}};s={};t(s,["blur","focus","keydown","mousedown","mousemove","scroll"],document);t(s,["resize","load","unload"],window);if(r.isChrome||r.isSafari||r.isIE||r.isOpera){t(s,["blur","focus"],window)}return s}()),attach:function(t,s,u){if(t===undefined||s===undefined||u===undefined){return}o("Attach "+s);if(t.addEventListener){t.addEventListener(s,u,false)}else{if(t.attachEvent){t.attachEvent("on"+s,u)}}},detach:function(t,s,u){if(t===undefined||s===undefined||u===undefined){return}o("Detach "+s);if(t.addEventListener){t.removeEventListener(s,u,false)}else{if(t.attachEvent){t.detachEvent("on"+s,u)}}},attachAll:function(){var s;while((s=k.pool.shift())!==undefined){k.attach(s[0],s[1],s[2])}}};function d(){try{document.documentElement.doScroll("left")}catch(s){window.setTimeout(d,1);return}o("DOM Ready !");k.domReady=true;k.attachAll();o("Attach Ok!")}if(document.addEventListener){a=function(){k.detach(document,"DOMContentLoaded",a);o("DOM Ready !");k.domReady=true;k.attachAll();o("Attach Ok!")};k.attach(document,"DOMContentLoaded",a)}else{a=function(){if(document.readyState==="complete"){k.detach(document,"readystatechange",a);d()}};k.attach(document,"readystatechange",a)}b=(function(){var u,s,t;u={};s=0;return{create:function(){while(s<=10000){t="wr_vis_tk_"+parseInt(Math.random()*1000000,10);if(u[t]===undefined){u[t]=1;s+=1;return t}}return undefined},prepareData:function(v){if(b.exist(v)){return}l[v]=q(h)},exist:function(v){return v!==undefined&&l[v]!==undefined}}}());return{track:function(s,u,t){return g.register(s,u,t)},init:function(x){var v,u,s,y,t,w;if(n(x)||n(x.call)||n(x.callkey)){o("Missing parameters, need 'call' and 'callkey' to be filled !");return}if(!(r.isFirefox||r.isIE||r.isChrome)){o("Browser not supported !");return}if(r.isIframe){o("iFrame not supported !");return}v=b.create();if(v===undefined){o("Can't get a valid token !");return}b.prepareData(v);if(x!==undefined){for(u in x){if(x.hasOwnProperty(u)){if(u!==undefined&&typeof u!=="object"&&l[v].params[u]!==undefined){l[v].params[u]=x[u]}}}}s=["scroll","resize"];t=function(z){g.check(v,z)};for(u in s){if(s.hasOwnProperty(u)){k.add(k.type[s[u]],s[u],t)}}y=["blur","focus","keydown","mousedown","mousemove","scroll","resize"];w=function(z){g.inactivityCheck(v,z)};for(u in y){if(y.hasOwnProperty(u)){k.add(k.type[y[u]],y[u],w)}}window.setInterval(function(z){g.check(v,z)},250);if(r.isChrome){k.add(k.type.unload,"beforeunload",function(){o("Unloading page, calling fcgi ...");for(var z in l){if(l.hasOwnProperty(z)){g.release(z)}}})}else{k.add(k.type.unload,"unload",function(){o("Unloading page, calling fcgi ...");for(var z in l){if(l.hasOwnProperty(z)){g.release(z)}}})}return v},registerMonitor:function(s,t){if(!b.exist(s)){return false}if(t!==undefined&&typeof t==="function"){l[s].externalMonitor=t}}}}());if(typeof window.wbo_visibility==="object"&&typeof window.wbo_visibility.init==="object"&&typeof window.wbo_visibility.params==="object"){window.vistokens=window.vistokens||{};window.vistokens[window.wbo_visibility.init.callkey]=window.vistokens[window.wbo_visibility.init.callkey]||WR_VIS__VERSION__.init(window.wbo_visibility.init);WR_VIS__VERSION__.track(window.vistokens[window.wbo_visibility.init.callkey],window.wbo_visibility.id,window.wbo_visibility.params)};